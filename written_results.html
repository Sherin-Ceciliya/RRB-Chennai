<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Written Results — RRB Chennai</title>

  <!-- Tailwind v2 CDN -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />

  <style>
    :root {
      --light-border: #e6eef6;
      --muted: #6b7280;
      --accent: #0b63a7;
      --body-font-size: 15px;
    }
    html, body { height: 100%; }
    body {
      min-height: 100%;
      background-color: #f3f4f6;
      display: flex;
      flex-direction: column;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      font-size: var(--body-font-size);
      line-height: 1.45;
      color: #1f2937;
    }

    /* Header */
    .custom-header { background-color: #003366; }
    .nav-link { color: #fff; }
    .nav-link:hover { color: #a8d0ff; }

    /* Table container */
    .table-container {
      background: white;
      border-radius: 0.5rem;
      box-shadow: 0 1px 2px rgba(16,24,40,0.04);
      overflow-x: auto;
      border: 1px solid var(--light-border);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 720px;
    }

    .table-head { background-color: var(--accent); color: white; }
    .table-head th { font-weight: 700; padding: 12px 14px; text-align: left; font-size: 0.95rem; }

    th, td {
      border-bottom: 1px solid var(--light-border);
      padding: 12px 14px;
      vertical-align: top;
      font-size: 0.95rem;
    }
    th:not(:last-child), td:not(:last-child) { border-right: 1px solid #f3f7fb; }

    td:first-child { color: #0f172a; font-weight: 600; width: 160px; }

    .post-title { font-weight: 600; color: #0f172a; margin-bottom: 6px; font-size: 0.98rem; }
    .post-desc {
      margin: 0;
      color: var(--muted);
      font-size: 0.9rem;
      line-height: 1.35;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Links column as bullets */
    .links-wrapper {
      display: block;
      padding-left: 18px;
    }
    .links-wrapper li {
      list-style-type: disc;
      margin-bottom: 4px;
    }
    .link-inline {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      text-decoration: none;
      color: var(--accent);
      font-weight: 600;
      font-size: 0.9rem;
      padding: 2px 0;
    }
    .link-inline:hover {
      background: rgba(11,99,167,0.06);
      transform: translateY(-1px);
    }
    .link-icon {
      width: 14px;
      height: 14px;
      display: inline-block;
      vertical-align: middle;
    }

    tbody tr:hover { background: rgba(13,66,110,0.02); }

    #page-description { font-size: 0.95rem; }

    @media (max-width: 768px) {
      :root { --body-font-size: 14px; }
      .table-head th, th, td { font-size: 0.85rem; padding: 10px 12px; }
      table { min-width: 600px; }
      td:first-child { width: 120px; }
      .post-desc { -webkit-line-clamp: 2; }
    }

    footer { margin-top: auto; }
  </style>
</head>
<body>

  <!-- Header -->
  <header class="custom-header text-white shadow-md">
    <div class="flex justify-between items-center h-28 w-full px-6">
      <div class="flex items-center space-x-4">
        <img src="images/railways.png" alt="RRB Logo" class="h-20 w-auto" />
        <div>
          <h1 class="text-2xl font-bold">Railway Recruitment Board</h1>
          <p class="text-lg">Chennai</p>
        </div>
      </div>

      <nav class="hidden md:flex space-x-8 text-lg font-semibold">
        <a href="index.html" class="nav-link">Home</a>
        <a href="about.html" class="nav-link">About Us</a>
        <a href="results.html" class="nav-link">Results</a>
        <a href="recruitment.html" class="nav-link">Recruitments</a>
        <a href="contact.html" class="nav-link">Contact</a>
      </nav>
    </div>
  </header>

  <main class="flex-1 w-full">
    <div class="max-w-7xl mx-auto px-6 py-8">

      <div class="mb-4">
        <h2 class="text-3xl font-extrabold text-blue-800">Written Examination Notices & Results</h2>
        <div class="mt-2 h-0.5 w-full bg-gray-200"></div>
      </div>

      <!-- Description box -->
      <div id="page-description" class="mb-6 bg-white border border-gray-200 rounded-lg shadow-sm p-5 text-gray-700">
        <p class="italic text-sm text-gray-600">
          This page provides the results for various examinations conducted by the board, including both the written examinations and the Computer Based Tests (CBT). Here, candidates can view their scores, check their performance, and analyze their results in a structured and easy-to-read format.
        </p>
      </div>

      <!-- Filters -->
      <section class="mb-4 bg-white border border-gray-200 rounded-lg shadow-sm p-4">
        <div class="flex flex-col md:flex-row md:items-end md:space-x-4 space-y-4 md:space-y-0">
          <div class="flex-1">
            <label class="block text-sm font-medium text-gray-700 mb-1">Filter by CEN No.</label>
            <input id="filter-cen" type="text" placeholder="e.g. 01/2018 or CEN_01_2025" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-300" />
          </div>

          <div class="flex-1">
            <label class="block text-sm font-medium text-gray-700 mb-1">Filter by Category</label>
            <input id="filter-category" type="text" placeholder='e.g. "1-156" or "01" or "1,2,3"' class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-300" />
          </div>

          <div class="flex-1">
            <label class="block text-sm font-medium text-gray-700 mb-1">Filter by Post</label>
            <input id="filter-post" type="text" placeholder="e.g. 'NTPC' or 'Staff Nurse'" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-300" />
          </div>

          <div class="w-full md:w-auto">
            <button id="clear-filters" class="px-4 py-2 bg-gray-100 border rounded-md hover:bg-gray-200">Clear</button>
          </div>
        </div>
      </section>

      <!-- Table container -->
      <div class="table-container">
        <table id="results-table" class="min-w-full">
          <thead class="table-head">
            <tr>
              <th data-column="cenNo" style="width:160px; cursor:pointer">
                <div class="flex items-center justify-start">
                  <span>CEN No.</span>
                  <span class="ml-2 caret" id="caret-cen"></span>
                </div>
              </th>

              <th data-column="category" style="width:180px; cursor:pointer">
                <div class="flex items-center">
                  <span>Category</span>
                  <span class="ml-2 caret" id="caret-category"></span>
                </div>
              </th>

              <th data-column="post" style="min-width:420px; cursor:pointer">
                <div class="flex items-center">
                  <span>Recruitment Role / Description</span>
                  <span class="ml-2 caret" id="caret-post"></span>
                </div>
              </th>

              <th style="width:220px; text-align:left">Details</th>
            </tr>
          </thead>

          <tbody id="table-body" class="bg-white">
            <tr>
              <td colspan="4" class="px-6 py-8 text-center text-gray-400">Loading data…</td>
            </tr>
          </tbody>
        </table>
      </div>

    </div>
  </main>

  <footer class="bg-gray-900 text-white py-8">
    <div class="max-w-6xl mx-auto px-6 grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <h4 class="text-xl font-semibold mb-2">Government of India</h4>
        <p class="text-sm">Ministry of Railways</p>
        <p class="text-sm mt-1">For Enquiry call: <span class="font-medium">044 - 2827 5323</span></p>
      </div>

      <div class="flex flex-col items-start md:items-end">
        <h4 class="text-xl font-semibold mb-2">Quick Links</h4>
        <ul class="space-y-1 text-sm">
          <li><a href="about.html" class="hover:text-gray-300 transition-colors">About Us</a></li>
          <li><a href="results.html" class="hover:text-gray-300 transition-colors">Results</a></li>
          <li><a href="recruitment.html" class="hover:text-gray-300 transition-colors">Recruitments</a></li>
          <li><a href="contact.html" class="hover:text-gray-300 transition-colors">Contact Us</a></li>
        </ul>
      </div>
    </div>

    <div class="border-t border-gray-700 mt-6 pt-4 text-center text-sm text-gray-400">
      © 2025 Railway Recruitment Board Chennai. All Rights Reserved.
    </div>
  </footer>

<script>
(function () {
  const tbody = document.getElementById('table-body');
  const filterCen = document.getElementById('filter-cen');
  const filterCategory = document.getElementById('filter-category');
  const filterPost = document.getElementById('filter-post');
  const clearFiltersBtn = document.getElementById('clear-filters');
  let currentSort = { column: 'cenNo', dir: 'asc' };
  let allEntries = [];

  async function fetchJson() {
    const candidates = ['writtenExam.json', 'written_results.json'];
    for (let url of candidates) {
      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error('Not found');
        return await res.json();
      } catch (e) {}
    }
    throw new Error('Could not find JSON file.');
  }

  function normalizeCell(value) {
    if (Array.isArray(value)) return value.join(', ');
    if (!value) return '';
    return String(value);
  }

  function cmpStr(a, b) {
    a = a ? a.toLowerCase() : '';
    b = b ? b.toLowerCase() : '';
    return a < b ? -1 : a > b ? 1 : 0;
  }

  function sortEntries(entries, column, dir) {
    const d = dir === 'asc' ? 1 : -1;
    return entries.sort((x, y) => {
      if (column === 'cenNo') {
        const r = cmpStr(normalizeCell(x.cenNo), normalizeCell(y.cenNo));
        return r !== 0 ? r * d : cmpStr(normalizeCell(x.category), normalizeCell(y.category)) * d;
      }
      if (column === 'category') {
        const r = cmpStr(normalizeCell(x.category), normalizeCell(y.category));
        return r !== 0 ? r * d : cmpStr(normalizeCell(x.cenNo), normalizeCell(y.cenNo)) * d;
      }
      return cmpStr(normalizeCell(x.post), normalizeCell(y.post)) * d;
    });
  }

  function externalIcon() {
    const ns = 'http://www.w3.org/2000/svg';
    const svg = document.createElementNS(ns, 'svg');
    svg.setAttribute('viewBox', '0 0 24 24');
    svg.setAttribute('class', 'link-icon');
    svg.setAttribute('aria-hidden', 'true');
    svg.innerHTML = '<path fill="currentColor" d="M14 3h7v7h-2V6.41l-9.29 9.3-1.42-1.42 9.3-9.29H14V3zM5 5h5V3H3v7h2V5zm0 14v-5H3v7a1 1 0 0 0 1 1h7v-2H5z"/>';
    return svg;
  }

  function makeRow(item) {
    const tr = document.createElement('tr');

    const tdCen = document.createElement('td');
    tdCen.className = 'px-6 py-4 text-gray-800';
    tdCen.textContent = normalizeCell(item.cenNo);
    tr.appendChild(tdCen);

    const tdCat = document.createElement('td');
    tdCat.className = 'px-6 py-4 text-gray-700';
    tdCat.textContent = normalizeCell(item.category);
    tr.appendChild(tdCat);

    const tdPost = document.createElement('td');
    tdPost.className = 'px-6 py-4 text-gray-700';
    tdPost.textContent = item.postTitle || item.post || '';
    tr.appendChild(tdPost);

    const tdLinks = document.createElement('td');
    tdLinks.className = 'px-6 py-4 text-left';
    if (Array.isArray(item.links) && item.links.length > 0) {
      if (item.links.length > 1) {
        // Multiple links → bullets
        const ul = document.createElement('ul');
        ul.className = 'links-wrapper';
        item.links.forEach(linkObj => {
          const li = document.createElement('li');
          const a = document.createElement('a');
          a.href = linkObj.url || '#';
          a.target = '_blank';
          a.rel = 'noopener noreferrer';
          a.className = 'link-inline';
          a.textContent = linkObj.name || 'View';
          a.appendChild(externalIcon());
          li.appendChild(a);
          ul.appendChild(li);
        });
        tdLinks.appendChild(ul);
      } else {
        // Single link → inline
        const a = document.createElement('a');
        const linkObj = item.links[0];
        a.href = linkObj.url || '#';
        a.target = '_blank';
        a.rel = 'noopener noreferrer';
        a.className = 'link-inline';
        a.textContent = linkObj.name || 'View';
        a.appendChild(externalIcon());
        tdLinks.appendChild(a);
      }
    } else {
      tdLinks.innerHTML = '<span class="text-sm text-gray-400">—</span>';
    }
    tr.appendChild(tdLinks);


    return tr;
  }

  function renderTable() {
    const cenFilter = filterCen.value.trim().toLowerCase();
    const catFilter = filterCategory.value.trim().toLowerCase();
    const postFilter = filterPost.value.trim().toLowerCase();

    let filtered = allEntries.filter(item => {
      const cen = normalizeCell(item.cenNo).toLowerCase();
      const cat = normalizeCell(item.category).toLowerCase();
      const post = normalizeCell(item.post || item.postTitle).toLowerCase();

      if (cenFilter && !cen.includes(cenFilter)) return false;
      if (catFilter && !cat.includes(catFilter)) return false;
      if (postFilter && !post.includes(postFilter)) return false;
      return true;
    });

    filtered = sortEntries(filtered, currentSort.column, currentSort.dir);
    tbody.innerHTML = '';
    if (!filtered.length) {
      tbody.innerHTML = '<tr><td colspan="4" class="px-6 py-6 text-center text-gray-500">No records match your filters.</td></tr>';
      return;
    }
    filtered.forEach(item => tbody.appendChild(makeRow(item)));
  }

  function updateCarets() {
    const map = { cenNo: 'caret-cen', category: 'caret-category', post: 'caret-post' };
    for (const col of ['cenNo', 'category', 'post']) {
      const el = document.getElementById(map[col]);
      if (!el) continue;
      el.textContent = (currentSort.column === col) ? (currentSort.dir === 'asc' ? '▲' : '▼') : '';
    }
  }

  function initSorting() {
    const ths = document.querySelectorAll('thead th[data-column]');
    ths.forEach(th => {
      th.addEventListener('click', () => {
        const col = th.getAttribute('data-column');
        if (currentSort.column === col) {
          currentSort.dir = currentSort.dir === 'asc' ? 'desc' : 'asc';
        } else {
          currentSort.column = col;
          currentSort.dir = 'asc';
        }
        updateCarets();
        renderTable();
      });
    });
  }

  function initFilters() {
    [filterCen, filterCategory, filterPost].forEach(inp => inp.addEventListener('input', renderTable));
    clearFiltersBtn.addEventListener('click', () => {
      filterCen.value = '';
      filterCategory.value = '';
      filterPost.value = '';
      renderTable();
    });
  }

  async function bootstrap() {
    try {
      const json = await fetchJson();
      allEntries = Array.isArray(json) ? json : (json.entries || []);
      allEntries = allEntries.map(e => ({
        cenNo: e.cenNo || '',
        category: e.category || '',
        post: e.post || e.postTitle || '',
        postTitle: e.postTitle || '',
        links: e.links || []
      }));
      currentSort = { column: 'cenNo', dir: 'asc' };
      updateCarets();
      initSorting();
      initFilters();
      renderTable();
    } catch (err) {
      tbody.innerHTML = `<tr><td colspan="4" class="px-6 py-8 text-center text-gray-400">Failed to load data: ${err.message}</td></tr>`;
    }
  }

  bootstrap();
})();
</script>

</body>
</html>
